# novelWriter MCP混合架构设计文档

## Table of Contents

- [novelWriter MCP混合架构设计文档](#table-of-contents)
  - [1. 关键架构理解（开发者必读）](./1-关键架构理解开发者必读.md)
    - [1.1 现有AI模块深度分析](./1-关键架构理解开发者必读.md#11-现有ai模块深度分析)
      - [🔍 NWAiApi功能层次分析](./1-关键架构理解开发者必读.md#nwaiapi功能层次分析)
      - [🎯 职责分离的必要性](./1-关键架构理解开发者必读.md#职责分离的必要性)
      - [⚡ 架构风险警告](./1-关键架构理解开发者必读.md#架构风险警告)
  - [2. 引言](./2-引言.md)
    - [2.1 文档目的](./2-引言.md#21-文档目的)
    - [2.2 现有项目分析](./2-引言.md#22-现有项目分析)
    - [1.3 开发分支信息](./2-引言.md#13-开发分支信息)
    - [1.4 变更日志](./2-引言.md#14-变更日志)
  - [3. 增强范围和集成策略](./3-增强范围和集成策略.md)
    - [2.1 增强概览](./3-增强范围和集成策略.md#21-增强概览)
    - [3.2 集成方案](./3-增强范围和集成策略.md#32-集成方案)
    - [2.3 兼容性要求](./3-增强范围和集成策略.md#23-兼容性要求)
  - [4. 用户界面增强目标](./4-用户界面增强目标.md)
    - [4.1 与现有UI集成](./4-用户界面增强目标.md#41-与现有ui集成)
    - [4.2 修改/新增界面和视图](./4-用户界面增强目标.md#42-修改新增界面和视图)
    - [4.3 UI一致性要求](./4-用户界面增强目标.md#43-ui一致性要求)
  - [4. 技术栈分析](./4-技术栈分析.md)
    - [4.1 现有技术栈（基于Context7 MCP协议调研）](./4-技术栈分析.md#41-现有技术栈基于context7-mcp协议调研)
    - [4.2 新技术添加（基于MCP官方要求）](./4-技术栈分析.md#42-新技术添加基于mcp官方要求)
    - [4.3 MCP协议支持的传输方式](./4-技术栈分析.md#43-mcp协议支持的传输方式)
    - [4.4 技术决策理由](./4-技术栈分析.md#44-技术决策理由)
  - [5. 数据模型和Schema变更](./5-数据模型和schema变更.md)
    - [5.1 新增数据模型](./5-数据模型和schema变更.md#51-新增数据模型)
      - [模型1：HybridToolCall](./5-数据模型和schema变更.md#模型1hybridtoolcall)
      - [模型2：ToolExecutionResult](./5-数据模型和schema变更.md#模型2toolexecutionresult)
      - [模型3：ExternalMCPConnection](./5-数据模型和schema变更.md#模型3externalmcpconnection)
    - [5.2 Schema集成策略](./5-数据模型和schema变更.md#52-schema集成策略)
  - [7. 组件架构设计](./7-组件架构设计.md)
    - [6.1 新增组件概览](./7-组件架构设计.md#61-新增组件概览)
      - [组件1：NovelWriterAPI](./7-组件架构设计.md#组件1novelwriterapi)
      - [组件2：MCPServer](./7-组件架构设计.md#组件2mcpserver)
      - [组件3：ExternalMCPManager](./7-组件架构设计.md#组件3externalmcpmanager)
      - [组件4：SecurityController](./7-组件架构设计.md#组件4securitycontroller)
      - [组件5：PerformanceMonitor](./7-组件架构设计.md#组件5performancemonitor)
    - [6.2 组件交互架构（统一API中间层）](./7-组件架构设计.md#62-组件交互架构统一api中间层)
  - [8. API设计和集成](./8-api设计和集成.md)
    - [7.1 API集成策略](./8-api设计和集成.md#71-api集成策略)
    - [7.2 新增API端点](./8-api设计和集成.md#72-新增api端点)
      - [MCP协议标准端点](./8-api设计和集成.md#mcp协议标准端点)
      - [混合架构管理端点](./8-api设计和集成.md#混合架构管理端点)
    - [7.3 认证和授权集成](./8-api设计和集成.md#73-认证和授权集成)
  - [9. 源码树组织](./9-源码树组织.md)
    - [8.1 现有项目结构（重构为统一访问）](./9-源码树组织.md#81-现有项目结构重构为统一访问)
    - [8.2 新增文件组织（统一API中间层）](./9-源码树组织.md#82-新增文件组织统一api中间层)
    - [8.3 集成指导原则](./9-源码树组织.md#83-集成指导原则)
  - [10. 基础设施和部署集成](./10-基础设施和部署集成.md)
    - [9.1 现有基础设施分析](./10-基础设施和部署集成.md#91-现有基础设施分析)
    - [9.2 增强部署策略](./10-基础设施和部署集成.md#92-增强部署策略)
    - [9.3 零风险部署原则](./10-基础设施和部署集成.md#93-零风险部署原则)
    - [9.4 故障安全机制](./10-基础设施和部署集成.md#94-故障安全机制)
  - [11. 编码标准和测试策略](./11-编码标准和测试策略.md)
    - [10.1 现有标准遵循](./11-编码标准和测试策略.md#101-现有标准遵循)
    - [10.2 MCP模块特定要求](./11-编码标准和测试策略.md#102-mcp模块特定要求)
    - [10.3 项目测试环境配置](./11-编码标准和测试策略.md#103-项目测试环境配置)
    - [10.4 测试策略集成](./11-编码标准和测试策略.md#104-测试策略集成)
  - [12. 后续步骤](./12-后续步骤.md)
    - [11.1 故事管理者交接](./12-后续步骤.md#111-故事管理者交接)
    - [11.2 开发团队交接](./12-后续步骤.md#112-开发团队交接)
    - [11.3 架构决策总结](./12-后续步骤.md#113-架构决策总结)
    - [11.4 成功指标定义](./12-后续步骤.md#114-成功指标定义)
  - [13. 总结](./13-总结.md)
    - [12.1 架构质量指标](./13-总结.md#121-架构质量指标)
    - [12.2 关键特性](./13-总结.md#122-关键特性)
