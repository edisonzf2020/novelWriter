# 12. 后续步骤

## 11.1 故事管理者交接

**故事管理者提示**：
```
基于此Brownfield架构文档执行以下任务：

优先级：高
1. 审核PRD和架构的一致性：确认架构设计完全支持PRD中定义的11个故事
2. 验证集成检查点：每个故事的集成验证(IV1-IV3)都有对应的架构支持
3. 确认现有系统保护：架构确保每个故事执行时现有AI功能不受影响

关键架构决策确认：
- ✅ 统一API中间层：所有数据访问通过NovelWriterAPI，确保一致性和安全
- ✅ 架构重构设计：AI模块重构访问方式，提升整体架构质量
- ✅ 依赖注入模式：避免循环导入，确保架构清洁
- ✅ 官方MCP Python SDK：技术选择经过Context7验证，为最佳方案
- ✅ 渐进式部署：MCP功能作为可选依赖，不影响现有用户

首个故事建议：从Story 1.1开始，建立混合架构基础框架
```

## 11.2 开发团队交接

**开发团队提示**：
```
按照此架构文档开始实施，重点关注：

⚠️ 开发分支要求：
- 所有开发工作必须在 `ai-agent` 分支进行
- 切换命令：git checkout ai-agent
- 禁止在 `main` 分支直接开发

技术栈确认：
- Python 3.10+：现有要求，完全兼容
- MCP Python SDK：官方实现，pip install "novelwriter[ai-mcp]"
- FastMCP + streamable-http：最优性能传输协议
- Pydantic v2：数据验证，与MCP协议集成

测试环境设置：
1. 切换到开发分支：git checkout ai-agent
2. 激活虚拟环境：source writer/bin/activate
3. 运行测试命令：source writer/bin/activate && export QT_SCALE_FACTOR=1 && pytest --compat-env-file=test.env
4. 真实AI测试：test.env包含AI endpoint配置，用于集成测试验证
5. 确保所有新功能都在真实AI环境中测试通过

架构原则严格遵循：
1. 统一API访问：所有模块都通过NovelWriterAPI访问数据
2. 依赖注入：所有功能模块通过构造函数接收NovelWriterAPI
3. 单一访问路径：禁止绕过API层直接访问core
4. 接口分离：MCP工具、AI功能、安全控制独立实现
5. 性能要求：API访问<5ms，MCP工具<10ms，外部工具<200ms

实施序列：
第一阶段：统一API基础 (Story 1.1-1.2) - 创建NovelWriterAPI
第二阶段：AI模块重构 (Story 1.3) - ai/api.py → ai/ai_core.py重构
第三阶段：MCP工具实现 (Story 1.4-1.6) - 基于统一API的工具
第四阶段：监控和文档 (Story 1.7-1.11) - 完善监控和测试
```

## 11.3 架构决策总结

| 决策点 | 选择方案 | 理由 | 风险缓解 |
|--------|----------|------|----------|
| **集成策略** | 零侵入新增模块 | 保护现有投资，降低回归风险 | 完整向后兼容测试 |
| **MCP库选择** | 官方Python SDK | 标准兼容性，长期支持 | Context7验证最优选择 |
| **传输协议** | streamable-http | 性能优于WebSocket | 支持多协议降级 |
| **部署策略** | 可选依赖 + 渐进式 | 最小用户影响 | 故障安全机制 |

## 11.4 成功指标定义

**项目成功的量化指标**：
- **功能完整性**：8个本地工具全部实现，外部MCP连接成功
- **性能合规**：本地工具P95延迟<10ms，外部工具<200ms
- **兼容性验证**：现有AI功能100%正常工作
- **用户体验**：MCP功能可选启用，故障时透明降级
- **代码质量**：90%测试覆盖率，0个P0缺陷

---
