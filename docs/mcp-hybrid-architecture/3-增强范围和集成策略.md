# 3. 增强范围和集成策略

## 2.1 增强概览

- **增强类型**：架构演进型 - 工具化包装层
- **范围**：在现有AI架构上添加MCP工具化抽象层
- **集成影响**：中等影响 - 新增模块，现有功能保持不变

## 3.2 集成方案

**代码集成策略**：
- **新增统一API层**：`novelwriter/api/novelwriter_api.py` 作为所有数据访问的统一入口
- **AI模块重构**：`novelwriter/ai/` 通过统一API访问数据，不直接访问core
- **依赖注入模式**：所有功能模块通过构造函数接收`NovelWriterAPI`实例
- **单一访问路径**：`功能模块` → `api/novelwriter_api.py` → `core/` 统一依赖链

**数据库集成**：
- **统一数据访问**：所有模块通过`NovelWriterAPI`访问数据
- **事务管理集中**：在统一API层实现事务管理
- **缓存层复用**：统一API层集成现有缓存机制

**UI集成**：
- **扩展现有面板**：在AI Copilot Dock基础上增加MCP管理界面
- **配置集成**：扩展现有AI设置对话框
- **状态栏增强**：在现有状态栏添加工具调用指标

## 2.3 兼容性要求

- **现有API兼容性**：`NWAiApi`接口100%保持不变
- **数据库Schema兼容性**：无任何数据格式变更
- **UI/UX一致性**：新增界面遵循现有AI Copilot设计风格
- **性能影响**：本地工具调用延迟增加<1ms

---
