# 2. 需求 (Requirements)

## 2.1 功能需求 (Functional Requirements)

**FR1**: 系统必须创建统一API中间层`api/novelwriter_api.py`，作为所有数据访问的唯一入口点，替代各模块对core的直接访问。

**FR2**: 系统必须将现有`ai/api.py`重构为`ai/ai_core.py`，分离通用数据访问功能到统一API层，保留AI特定业务逻辑。

**FR3**: 系统必须实现`MCPServer`类，支持本地工具直接调用和外部MCP工具协议调用的统一路由。

**FR4**: 系统必须实现8个核心本地工具：项目信息、文档读写、项目树、创建文档、全局搜索、标签列表、字数统计。

**FR5**: 系统必须支持通过MCP协议连接和调用外部工具生态（时间服务、GitHub集成等）。

**FR6**: 所有新模块必须通过构造函数依赖注入接收API实例，避免循环导入和紧耦合。

## 2.2 非功能需求 (Non-Functional Requirements)

**NFR1**: 重构过程必须保持现有AI Copilot功能100%可用，不得破坏任何现有用户工作流。

**NFR2**: 性能要求 - 统一API访问延迟<5ms，本地工具调用延迟<10ms (P95)，外部MCP工具调用延迟<200ms (P95)。

**NFR3**: 新增架构层的内存占用不得超过现有应用内存使用的15%。

**NFR4**: 系统必须支持优雅降级，外部工具不可用时本地功能完全正常。

## 2.3 兼容性需求 (Compatibility Requirements)

**CR1**: 现有`extensions/ai_copilot/`模块必须无需修改即可继续工作，保持API接口向后兼容。

**CR2**: 现有`AIConfig`系统必须保持完全兼容，新增配置通过扩展实现，无任何格式变更。

**CR3**: 项目文件格式、缓存格式、配置文件格式必须保持100%兼容，确保用户数据无损。

**CR4**: 现有UI主题系统、国际化机制必须完全兼容，新增界面遵循现有设计规范。

---
