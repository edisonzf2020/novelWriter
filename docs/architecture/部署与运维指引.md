# 部署与运维指引

- **依赖安装**：AI 功能依赖 `httpx` 等可选库，通过 `pip install novelWriter[ai]` 或 `pip install .[ai]` 进行安装；上线前运行 `python -m pytest tests/test_ai/test_ai_suggestions.py` 验证环境满足可选依赖。
- **上线检查**：在预生产环境中执行 `CONFIG.ai.create_provider()` 或 `novelwriter --info`，确认能力检测成功，并保存 `CONFIG.ai.getProviderCapabilitiesSummary()` 输出以备诊断。
- **回滚策略**：若需禁用 Copilot，可在偏好设置中关闭 AI 功能并恢复 `novelWriter.conf` 中的 `AI` 段落快照；必要时回退至 Story 1.1 标签并重新发布。
- **监控与支持**：持续关注日志中的 `provider.request.failed`、`suggestion.apply_failed` 事件；若发生长时间故障，由 Feature Owner 协调回滚并向支持团队同步状态。
- **回滚触发条件**：当 10 分钟内连续出现 3 次 `provider.request.failed` 或者模型响应时间超过 90 秒且持续 5 分钟时，立即执行 Story 1.3 的回滚方案，并通告支持团队暂停 Copilot 功能。
- **速率限制与重试策略**：默认将 OpenAI 兼容接口限制为 60 req/min，UI 触发的写入操作需通过去抖 2 秒的节流队列；若收到 `429` 或 `503` 响应，按 2s/4s/8s 指数退避最多重试 3 次，并在超过阈值时提示用户稍后重试。
