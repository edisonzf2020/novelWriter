# Story 0.1: NWAiApi 基础骨架

## Status
Draft

## Story
**As a** novelWriter 核心开发者,
**I want** 在 `novelwriter/ai/` 目录下设计并实现 `NWAiApi` 的基础结构与相关数据模型骨架,
**so that** 后续 AI 功能拥有统一的数据传输对象与异常体系, 并能安全地对接核心业务层。

## Acceptance Criteria
1. 在 `novelwriter/ai/models.py` 中定义核心数据类 (例如 `DocumentRef`, `TextRange`), 提供完整类型注解与文档字符串。
2. 在 `novelwriter/ai/errors.py` 中定义基础异常体系 (例如 `NWAiError`), 用于统一处理 AI 域内错误。
3. 在 `novelwriter/ai/api.py` 中定义 `NWAiApi` 类的基础结构, 包含必要的初始化、接口占位与文档说明, 并保持与既有架构模式一致。

## Tasks / Subtasks
- [ ] 建立 `novelwriter/ai/` 包结构与 `__init__.py`, 为后续模块提供命名空间 (AC: 1,3; 参考 docs/brownfield-architecture.md#项目结构-集成后)
- [ ] 设计 `models.py` 中的数据传输对象骨架 (AC: 1; 参考 docs/brownfield-architecture.md#核心架构原则-源自-docstechnical)
  - [ ] 定义 `DocumentRef`, `TextRange` 等核心数据模型, 并补充类型注解与文档字符串 (AC: 1; 参考 docs/brownfield-architecture.md#快速参考---关键文件和入口点)
- [ ] 建立 `errors.py` 并实现基础异常层次 `NWAiError` 等 (AC: 2; 参考 docs/brownfield-architecture.md#核心架构原则-源自-docstechnical)
- [ ] 在 `api.py` 中定义 `NWAiApi` 类骨架, 保持对 `core` 层的安全封装, 避免直接依赖 `gui` (AC: 3; 参考 docs/brownfield-architecture.md#核心架构原则-源自-docstechnical)
  - [ ] 为未来的只读接口预留方法签名与详细文档字符串, 体现事务与安全设计的扩展点 (AC: 3; 参考 docs/brownfield-architecture.md#技术摘要)
- [ ] 为新增模块编写基础单元测试骨架, 配置 `pytest` 用例结构以覆盖数据模型与异常 (AC: 1,2,3; 参考 docs/source/technical/tests.rst#Running Tests)

## Dev Notes
**Previous Story Insights:** 无上一故事可供参考。

**Data Models:** 在 `novelwriter/ai/` 包中定义数据传输对象是新增 AI 核心层的基础, 必须遵守分层架构, 与 `gui` 层解耦。[Source: docs/brownfield-architecture.md#核心架构原则-源自-docstechnical]

**API Specifications:** `NWAiApi` 需要作为核心层的安全桥梁, 保持与 `core` 的整洁接口并遵循既有架构原则。[Source: docs/brownfield-architecture.md#技术摘要]

**Component Specifications:** 架构文档仅描述主窗口等 GUI 扩展点, 对当前故事无直接要求。[Source: docs/brownfield-architecture.md#快速参考---关键文件和入口点]

**File Locations:** 新增的 `ai` 包需位于 `novelwriter/ai/`, 并通过 `api.py`, `models.py`, `errors.py` 等文件组织结构。[Source: docs/brownfield-architecture.md#项目结构-集成后]

**Testing Requirements:** 项目使用 `pytest` 与 `pytest-qt`; 新模块的单元测试需放入现有 `tests` 结构并遵循命名规范, 可通过 `pytest -k` 过滤运行。[Source: docs/source/technical/tests.rst#Running Tests]

**Technical Constraints:** 必须遵守分层架构, 避免 `ai` 包直接依赖 `gui`, 并确保所有代码具备类型注解与文档字符串。[Source: docs/brownfield-architecture.md#核心架构原则-源自-docstechnical]

## Testing
- 遵循 `pytest`/`pytest-qt` 测试框架, 在相关测试模块中新增覆盖, 支持通过 `pytest -v -k` 过滤运行。[Source: docs/source/technical/tests.rst#Running Tests]
- 为 `DocumentRef`、`TextRange` 等数据模型编写实例化与验证测试, 确认字段类型和默认值符合 AC1。
- 针对 `NWAiError` 及其后续子类设计异常抛出与消息传递测试, 确认统一错误处理契约 (AC2)。
- 为 `NWAiApi` 骨架提供初始化与占位方法的单元测试, 确认尚未实现的接口显式抛出占位异常或返回约定值, 保障 AC3。

## Change Log
| 日期 | 版本 | 描述 | 作者 |
| --- | --- | --- | --- |
| 2025-09-16 | 0.1 | 初始草稿 | Scrum Master Bob |

## Dev Agent Record
### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results

